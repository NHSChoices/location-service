CREATE TABLE locations(LocationId INTEGER PRIMARY KEY AUTOINCREMENT,X_COORDINATE FLOAT,Y_COORDINATE FLOAT,ORGANISATION_NAME VARCHAR(100),BLPU_ORGANISATION VARCHAR(100),DEPARTMENT_NAME VARCHAR(100),BUILDING_NAME VARCHAR(100),SAO_TEXT VARCHAR(255),PAO_START_NUMBER INT,PAO_START_SUFFIX VARCHAR(10),PAO_TEXT VARCHAR(255),STREET_DESCRIPTION VARCHAR(100),LOCALITY VARCHAR(100),TOWN_NAME VARCHAR(100),ADMINISTRATIVE_AREA VARCHAR(100),POST_TOWN VARCHAR(100),POSTCODE VARCHAR(10),POSTCODE_LOCATOR VARCHAR(10)
);

ATTACH 'importdata.db' AS db1;

INSERT INTO locations(X_COORDINATE,Y_COORDINATE,ORGANISATION_NAME,BLPU_ORGANISATION,DEPARTMENT_NAME,BUILDING_NAME,SAO_TEXT,PAO_START_NUMBER,PAO_START_SUFFIX,PAO_TEXT,STREET_DESCRIPTION,LOCALITY,TOWN_NAME,ADMINISTRATIVE_AREA,POST_TOWN,POSTCODE,POSTCODE_LOCATOR) SELECT X_COORDINATE,Y_COORDINATE,ORGANISATION_NAME,BLPU_ORGANISATION,DEPARTMENT_NAME,BUILDING_NAME,SAO_TEXT,PAO_START_NUMBER,PAO_START_SUFFIX,PAO_TEXT,STREET_DESCRIPTION,LOCALITY,TOWN_NAME,ADMINISTRATIVE_AREA,POST_TOWN,POSTCODE_LOCATOR,lower(replace(POSTCODE_LOCATOR," ","")) FROM db1.Addresses limit 100;

CREATE INDEX pcode_index ON locations(POSTCODE_LOCATOR);

CREATE VIRTUAL TABLE locations_srch USING fts4(content="locations", PAO_START_NUMBER VARCHAR(10), PAO_START_SUFFIX VARCHAR(10), STREET_DESCRIPTION VARCHAR(100), TOWN_NAME VARCHAR(100), ADMINISTRATIVE_AREA VARCHAR(100), BUILDING_NAME VARCHAR(100), ORGANISATION_NAME VARCHAR(100), LOCALITY VARCHAR(100), POSTCODE_LOCATOR VARCHAR(10), tokenize=porter);

INSERT INTO locations_srch(docid,PAO_START_NUMBER,PAO_START_SUFFIX,STREET_DESCRIPTION,TOWN_NAME,ADMINISTRATIVE_AREA,BUILDING_NAME,ORGANISATION_NAME,LOCALITY,POSTCODE_LOCATOR) SELECT LocationId, PAO_START_NUMBER,PAO_START_SUFFIX,STREET_DESCRIPTION,TOWN_NAME,ADMINISTRATIVE_AREA,BUILDING_NAME,ORGANISATION_NAME,LOCALITY,POSTCODE_LOCATOR FROM locations;


